"use strict";(self.webpackChunkalasta_ui=self.webpackChunkalasta_ui||[]).push([[357],{5357:(lt,C,s)=>{s.r(C),s.d(C,{TalentFinderModule:()=>at});var x=s(9808),m=s(2382),T=s(7311),R=s(845),_=s(4255),P=s(8397),b=s(7064),w=s(1035),O=s(727),g=s(3905),y=s(8372),f=s(5653),E=s(2776),S=s(2338),Z=s(826),t=s(5e3),U=s(171),N=s(1505),M=s(797),V=s(917),Y=s(4954),W=s(8254),D=s(851),F=s(9783),I=s(4119);const J=["searchInput"];function q(n,d){if(1&n){const e=t.EpF();t.TgZ(0,"div",19),t.TgZ(1,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw().addReview()}),t._UZ(2,"i",21),t._uU(3),t.qZA(),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("disabled",!e.selectedRows.length),t.xp6(2),t.hij(" Review selected (",e.selectedRows.length,") ")}}function L(n,d){1&n&&(t.TgZ(0,"p",22),t.TgZ(1,"small"),t._UZ(2,"i",23),t._uU(3,"Please be advised that "),t.TgZ(4,"em"),t._uU(5,"Job Description"),t.qZA(),t._uU(6," and "),t.TgZ(7,"em"),t._uU(8,"Location"),t.qZA(),t._uU(9," type filters will not properly work until Keiro release v2.2.0"),t.qZA(),t.qZA())}function z(n,d){1&n&&(t.TgZ(0,"th"),t._UZ(1,"p-tableHeaderCheckbox"),t.qZA())}function Q(n,d){if(1&n&&(t.TgZ(0,"tr"),t.YNc(1,z,2,0,"th",16),t.TgZ(2,"th"),t._uU(3,"Name"),t.qZA(),t.TgZ(4,"th"),t._uU(5,"Property"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"Position"),t.qZA(),t.TgZ(8,"th"),t._uU(9,"Department"),t.qZA(),t.TgZ(10,"th"),t._uU(11,"Area"),t.qZA(),t._UZ(12,"th"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.currentRWExists)}}function H(n,d){if(1&n&&t._UZ(0,"p-tableCheckbox",26),2&n){const e=t.oxw(2).$implicit;t.Q6J("value",e)}}function j(n,d){if(1&n&&(t.TgZ(0,"td"),t.YNc(1,H,1,1,"p-tableCheckbox",25),t.qZA()),2&n){const e=t.oxw().$implicit,i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.canSelectTalent(e))}}const $=function(n){return["..","view",n]};function B(n,d){if(1&n&&t._UZ(0,"a",27),2&n){const e=t.oxw().$implicit;t.Q6J("routerLink",t.VKq(1,$,e.id))}}function k(n,d){if(1&n&&(t.TgZ(0,"tr"),t.YNc(1,j,2,1,"td",16),t.TgZ(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.qZA(),t.TgZ(12,"td"),t.YNc(13,B,1,3,"a",24),t.qZA(),t.qZA()),2&n){const e=d.$implicit,i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.currentRWExists),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.location),t.xp6(2),t.Oqu(e.position),t.xp6(2),t.Oqu(e.department),t.xp6(2),t.Oqu(e.area),t.xp6(2),t.Q6J("ngIf",i.canViewTalent(e))}}function G(n,d){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij("(",e.selectedRows.length," selected)")}}function X(n,d){if(1&n&&(t.TgZ(0,"small"),t._uU(1),t.YNc(2,G,2,1,"span",16),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij("",e.total," total "),t.xp6(1),t.Q6J("ngIf",e.selectedRows.length)}}function K(n,d){if(1&n){const e=t.EpF();t.TgZ(0,"p-button",29),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).streamExcelFile()}),t.qZA()}}function tt(n,d){1&n&&t.YNc(0,K,1,0,"ng-template",28)}function et(n,d){if(1&n){const e=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw().addReview()}),t._UZ(1,"i",21),t._uU(2),t.qZA()}if(2&n){const e=t.oxw();t.xp6(2),t.hij(" Review selected (",e.selectedRows.length,") ")}}function it(n,d){1&n&&(t.TgZ(0,"p",31),t.TgZ(1,"strong"),t._uU(2,"Please note:"),t.qZA(),t._uU(3," Talents can only be selected if they don't have a review yet. To update a review, please contact your Keiro administrator."),t.qZA())}const nt=function(){return[10,25,50]};var l=(()=>{return(n=l||(l={}))[n.REVIEW_CYCLE=0]="REVIEW_CYCLE",n[n.MAP_POSITION=1]="MAP_POSITION",n[n.COUNTRY=2]="COUNTRY",n[n.PROPERTY=3]="PROPERTY",n[n.AREA=4]="AREA",n[n.DEPARTMENT=5]="DEPARTMENT",n[n.POSITION=6]="POSITION",l;var n})();let ot=(()=>{class n{constructor(e,i,o,a,r,c,p,u,st,rt){this.filterService=e,this.route=i,this.router=o,this.authStateService=a,this.store=r,this.talentService=c,this.locationsApi=p,this.positionsApi=u,this.reviewWindowsApi=st,this.talentMapBoxesApi=rt,this.canDownloadExcel=!1,this.total=0,this.page=0,this.step=25,this.rows=[],this.selectedRows=[],this.searchInputControl=new m.NI,this.loadingIndicator=!1,this.subscriptions=new O.w0,this.filterValue={},this.filtersSet=!1,this.isRowSelectable=h=>this.canSelectTalent(h.data),this.fetchLocations(),this.fetchPositions(),this.fetchReviewWindows(),this.fetchTalentMapPositions(),this.store.dispatch((0,E.Dz)()),this.reviewWindow$=r.pipe((0,w.Ys)("reviewWindowState")),this.talentManagement$=r.pipe((0,w.Ys)("talentManagementState")),this.subscriptions.add(this.authStateService.authState.subscribe(h=>{var v,A;h.identity&&(this.currentUser=h.identity),this.canDownloadExcel="SuperAdmin"==(null===(v=this.currentUser)||void 0===v?void 0:v.role)||"Admin"==(null===(A=this.currentUser)||void 0===A?void 0:A.role)})),this.subscriptions.add(this.reviewWindow$.subscribe(h=>{var v;this.currentReviewWindow=h.currentWindowReview?h.currentWindowReview:void 0,this.currentRWExists=!!(null===(v=this.currentReviewWindow)||void 0===v?void 0:v.id)})),this.subscriptions.add(this.talentManagement$.subscribe(h=>{this.total=h.talentFinderTotal,this.rows=h.talentsForFinder,this.loadingIndicator=!1})),this.subscriptions.add(this.searchInputControl.valueChanges.pipe((0,y.b)(350)).subscribe(h=>{this.searchInputControl.valid&&(this.refreshTalents(),this.router.navigate([],{relativeTo:this.route,queryParams:{q:encodeURIComponent(h)},queryParamsHandling:"merge",replaceUrl:!0}))}))}ngOnInit(){this.refreshTalents(),(0,g.z)(this.route.queryParams).then(e=>{if(e.f){const i=S.F.decodeURLParamToObject(e.f);this.filterService.addFilterValues(i)}if(e.q){const i=decodeURIComponent(e.q);this.searchInputControl.setValue(i)}}),this.filterService.valueChange.subscribe(e=>{const i=this.filterValue;this.filterValue=e,this.filtersSet=!(!this.filterValue||!(this.filterValue.country||this.filterValue.location||this.filterValue.area||this.filterValue.department||this.filterValue.position)),this.refreshTalents(),this.router.navigate([],{relativeTo:this.route,queryParams:{f:S.F.encodeObjectToURLParam(e)},queryParamsHandling:"merge",replaceUrl:!0}),(this.filterValue.country!=i.country||this.filterValue.location!=i.location)&&this.fetchLocations(),(this.filterValue.area!=i.area||this.filterValue.department!=i.department||this.filterValue.position!=i.position)&&this.fetchPositions()})}ngAfterViewInit(){var e;null===(e=this.input)||void 0===e||e.nativeElement.focus()}ngOnDestroy(){this.subscriptions.unsubscribe()}refreshTalents(){var e,i,o,a,r,c,p,u;this.store.dispatch((0,Z.pM)({windowRId:null===(e=this.filterValue)||void 0===e?void 0:e.windowRId,boxPosition:null===(i=this.filterValue)||void 0===i?void 0:i.boxPosition,country:null===(o=this.filterValue)||void 0===o?void 0:o.country,location:null===(a=this.filterValue)||void 0===a?void 0:a.location,area:null===(r=this.filterValue)||void 0===r?void 0:r.area,department:null===(c=this.filterValue)||void 0===c?void 0:c.department,position:null===(p=this.filterValue)||void 0===p?void 0:p.position,search:null===(u=this.searchInputControl)||void 0===u?void 0:u.value,page:this.page+1,step:this.step})),this.loadingIndicator=!0}streamExcelFile(){var e,i,o,a,r,c,p,u;this.talentService.downloadFileStream({windowRId:null===(e=this.filterValue)||void 0===e?void 0:e.windowRId,boxPosition:null===(i=this.filterValue)||void 0===i?void 0:i.boxPosition,country:null===(o=this.filterValue)||void 0===o?void 0:o.country,location:null===(a=this.filterValue)||void 0===a?void 0:a.location,area:null===(r=this.filterValue)||void 0===r?void 0:r.area,department:null===(c=this.filterValue)||void 0===c?void 0:c.department,position:null===(p=this.filterValue)||void 0===p?void 0:p.position,search:null===(u=this.searchInputControl)||void 0===u?void 0:u.value})}onSelectionChange(e){this.selectedRows=e}setPage(e){this.step=e.rows,this.page=Math.floor(e.first/e.rows),this.refreshTalents()}canSelectTalent(e){var i,o,a,r,c,p;return!(!this.currentRWExists||e.latestReviewId==(null===(i=this.currentReviewWindow)||void 0===i?void 0:i.id)||"SuperAdmin"!=(null===(o=this.currentUser)||void 0===o?void 0:o.role)&&"Admin"!=(null===(a=this.currentUser)||void 0===a?void 0:a.role)&&((null===(r=this.currentUser)||void 0===r?void 0:r._id)==e.id&&"Manager"!=(null===(c=this.currentUser)||void 0===c?void 0:c.role)||(null===(p=this.currentUser)||void 0===p?void 0:p.location)!=e.locationId))}canViewTalent(e){var i,o,a;return"SuperAdmin"==(null===(i=this.currentUser)||void 0===i?void 0:i.role)||"Admin"==(null===(o=this.currentUser)||void 0===o?void 0:o.role)||(null===(a=this.currentUser)||void 0===a?void 0:a.location)==e.locationId}onSelect(e){const i=e.selected;this.selectedRows.splice(0,this.selectedRows.length),this.selectedRows.push(...i)}addReview(){this.store.dispatch((0,Z.KD)({talents:this.selectedRows})),this.router.navigate(["app","review","create"])}fetchLocations(){(0,g.z)(this.locationsApi.findDistinctLocations(this.filterValue.country||void 0,this.filterValue.location||void 0)).then(e=>{const i=this.filterService.getMetadataWithId(l.COUNTRY.toString()),o=e.countries.map(c=>({name:c,value:c}));i.options=o;const a=this.filterService.getMetadataWithId(l.PROPERTY.toString()),r=e.properties.map(c=>({name:c,value:c}));a.options=r}).catch(e=>{console.error(e)})}fetchPositions(){(0,g.z)(this.positionsApi.findDistinctPositions(this.filterValue.area||void 0,this.filterValue.department||void 0,this.filterValue.position||void 0)).then(e=>{const i=this.filterService.getMetadataWithId(l.AREA.toString()),o=e.areas.map(u=>({name:u,value:u}));i.options=o;const a=this.filterService.getMetadataWithId(l.DEPARTMENT.toString()),r=e.departments.map(u=>({name:u,value:u}));a.options=r;const c=this.filterService.getMetadataWithId(l.POSITION.toString()),p=e.positions.map(u=>({name:u,value:u}));c.options=p}).catch(e=>{console.error(e)})}fetchReviewWindows(){(0,g.z)(this.reviewWindowsApi.findReviewWindows()).then(e=>{var i;const o=this.filterService.getMetadataWithId(l.REVIEW_CYCLE.toString()),a=e.reviewWindows.sort((r,c)=>Date.parse(c.startDate)-Date.parse(r.startDate)).map(r=>({name:r.name,value:r._id}));o.options=a,!this.filterValue.windowRId&&(null==o?void 0:o.required)&&this.filterService.addFilterWithId(l.REVIEW_CYCLE.toString(),null===(i=a[0])||void 0===i?void 0:i.value)}).catch(e=>{console.error(e)})}fetchTalentMapPositions(){(0,g.z)(this.talentMapBoxesApi.getBoxes()).then(e=>{const i=this.filterService.getMetadataWithId(l.MAP_POSITION.toString()),o=e.boxes.sort((a,r)=>a.title[a.title.length-1]-r.title[r.title.length-1]).map(a=>({name:a.title,value:""+a.pos}));i.options=o}).catch(e=>{console.error(e)})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(f.iZ),t.Y36(T.gz),t.Y36(T.F0),t.Y36(U.V),t.Y36(w.yh),t.Y36(N.C),t.Y36(M._),t.Y36(V.m),t.Y36(Y.m),t.Y36(W.M))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-talent-finder"]],viewQuery:function(e,i){if(1&e&&t.Gf(J,5),2&e){let o;t.iGM(o=t.CRH())&&(i.input=o.first)}},features:[t._Bn([{provide:"filterConfiguration",useValue:{dropdownOptions:[{id:l.COUNTRY.toString(),name:"Country"},{id:l.PROPERTY.toString(),name:"Property"},{id:l.AREA.toString(),name:"Area"},{id:l.DEPARTMENT.toString(),name:"Department"},{id:l.POSITION.toString(),name:"Position"},{id:l.REVIEW_CYCLE.toString(),name:"Review cycle"},{id:l.MAP_POSITION.toString(),name:"Talent Map placement"}],filtersMetadata:[{id:l.REVIEW_CYCLE.toString(),type:f.vA.DROPDOWN_SEARCH,visibleName:"Review Cycle",key:"windowRId",group:"Evaluation",children:[{id:l.MAP_POSITION.toString(),type:f.vA.DROPDOWN_SEARCH,visibleName:"Talent Map Placement",key:"boxPosition",group:"Evaluation"}]},{id:l.AREA.toString(),type:f.vA.DROPDOWN_SEARCH,visibleName:"Area",key:"area",group:"Job description",groupOrder:1},{id:l.DEPARTMENT.toString(),type:f.vA.DROPDOWN_SEARCH,visibleName:"Department",key:"department",group:"Job description",groupOrder:2},{id:l.POSITION.toString(),type:f.vA.DROPDOWN_SEARCH,visibleName:"Position",key:"position",group:"Job description",groupOrder:3},{id:l.COUNTRY.toString(),type:f.vA.DROPDOWN_SEARCH,visibleName:"Country",key:"country",group:"Location",groupOrder:1},{id:l.PROPERTY.toString(),type:f.vA.DROPDOWN_SEARCH,visibleName:"Property",key:"location",group:"Location",groupOrder:2}]}},{provide:f.iZ}])],decls:21,vars:18,consts:[[1,"animated","fadeIn"],[1,"card"],[1,"card-body"],[1,"form-row","justify-content-end"],[1,"col","mb-1"],[1,"has-search"],[1,"fa","fa-search","has-search-icon"],["type","text","placeholder","Search by name, email, or Keiro ID",1,"form-control",3,"formControl"],["searchInput",""],["class","col-12 col-sm-auto text-right mb-1",4,"ngIf"],[1,"d-block","mb-2",3,"service"],["class","mb-1 text-muted",4,"ngIf"],["styleClass","p-datatable-sm","responsiveLayout","scroll",3,"value","lazy","loading","paginator","rows","totalRecords","rowsPerPageOptions","selection","selectionPageOnly","rowSelectable","onLazyLoad","selectionChange"],["pTemplate","header"],["pTemplate","body"],["pTemplate","paginatorleft"],[4,"ngIf"],["class","btn btn-primary","title","Select some talents to add reviews",3,"click",4,"ngIf"],["class","mt-2",4,"ngIf"],[1,"col-12","col-sm-auto","text-right","mb-1"],["title","Select some talents to add reviews",1,"btn","btn-primary",3,"disabled","click"],["aria-hidden","true",1,"fa","fa-chart-line","mr-1"],[1,"mb-1","text-muted"],["aria-hidden","true",1,"fa","fa-info-circle","mr-1","text-warning"],["pButton","","class","p-button-rounded p-button-secondary","icon","fa fa-external-link-alt",3,"routerLink",4,"ngIf"],[3,"value",4,"ngIf"],[3,"value"],["pButton","","icon","fa fa-external-link-alt",1,"p-button-rounded","p-button-secondary",3,"routerLink"],["pTemplate","paginatorright"],["icon","fa fa-file-excel","styleClass","p-button-outlined","type","button","pTooltip","Download as Excel file","tooltipPosition","left",3,"click"],["title","Select some talents to add reviews",1,"btn","btn-primary",3,"click"],[1,"mt-2"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"h4"),t._uU(4,"Talent Finder"),t.qZA(),t.TgZ(5,"div",3),t.TgZ(6,"div",4),t.TgZ(7,"div",5),t._UZ(8,"span",6),t._UZ(9,"input",7,8),t.qZA(),t.qZA(),t.YNc(11,q,4,2,"div",9),t.qZA(),t._UZ(12,"alasta-filters-list",10),t.YNc(13,L,10,0,"p",11),t.TgZ(14,"p-table",12),t.NdJ("onLazyLoad",function(a){return i.setPage(a)})("selectionChange",function(a){return i.onSelectionChange(a)}),t.YNc(15,Q,13,1,"ng-template",13),t.YNc(16,k,14,7,"ng-template",14),t.YNc(17,X,3,2,"ng-template",15),t.YNc(18,tt,1,0,void 0,16),t.qZA(),t.YNc(19,et,3,1,"button",17),t.YNc(20,it,4,0,"p",18),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(9),t.Q6J("formControl",i.searchInputControl),t.xp6(2),t.Q6J("ngIf",i.currentRWExists&&i.selectedRows.length),t.xp6(1),t.Q6J("service",i.filterService),t.xp6(1),t.Q6J("ngIf",i.filtersSet),t.xp6(1),t.Q6J("value",i.rows)("lazy",!0)("loading",i.loadingIndicator)("paginator",!0)("rows",i.step)("totalRecords",i.total)("rowsPerPageOptions",t.DdM(17,nt))("selection",i.selectedRows)("selectionPageOnly",!0)("rowSelectable",i.isRowSelectable),t.xp6(4),t.Q6J("ngIf",i.canDownloadExcel),t.xp6(1),t.Q6J("ngIf",i.currentRWExists&&i.selectedRows.length),t.xp6(1),t.Q6J("ngIf",i.currentRWExists))},directives:[m.Fj,m.JJ,m.oH,x.O5,D.a,_.iA,F.jx,_.Mo,_.UA,T.yS,R.Hq,R.zx,I.u],styles:[".has-search[_ngcontent-%COMP%] > .form-control[_ngcontent-%COMP%]{padding-left:2.375rem}.has-search[_ngcontent-%COMP%] > .has-search-icon[_ngcontent-%COMP%]{position:absolute;z-index:2;display:block;width:2.375rem;height:2.375rem;line-height:2.375rem;text-align:center;pointer-events:none;color:#aaa}"]}),n})(),at=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[T.Bz.forChild([{path:"",component:ot}]),x.ez,m.UX,P.z8.forRoot(),b.i,_.U$,R.hJ,I.z]]}),n})()}}]);