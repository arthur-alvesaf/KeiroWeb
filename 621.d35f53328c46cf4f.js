"use strict";(self.webpackChunkalasta_ui=self.webpackChunkalasta_ui||[]).push([[621],{9621:(mt,_,o)=>{o.r(_),o.d(_,{CreateTalentModule:()=>rt});var d=o(6895),m=o(4789),f=o(8816),T=o(433),C=o(4175),A=o(2320),b=o(8099),x=o(2306),y=o(3345),u=o(5861),t=o(1571),Z=o(727),g=o(7197),r=o(625),p=o(582),S=o(171),I=o(9649),k=o(2733),N=o(921),F=o(797),V=o(917),w=o(4053),L=o(2962),M=o(549),J=o(1507),E=o(5303);function U(a,s){1&a&&(t.TgZ(0,"span",37),t._UZ(1,"app-shared-icon-tooltip",38),t.qZA())}function Q(a,s){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&a){const e=t.oxw(2).$implicit;t.xp6(1),t.AsE(" : ",(null==e?null:e.currentTalentValue).firstNames," ",(null==e?null:e.currentTalentValue).lastNames," ")}}function R(a,s){if(1&a&&(t.TgZ(0,"span"),t.YNc(1,U,2,0,"span",36),t.YNc(2,Q,2,2,"span",19),t.qZA()),2&a){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.Q6J("ngIf","INVALID"===e._talentStatus),t.xp6(1),t.Q6J("ngIf",n.ifTalentValueSet(e,"firstNames")&&n.ifTalentValueSet(e,"lastNames"))}}function Y(a,s){1&a&&(t.TgZ(0,"div",39),t._UZ(1,"i",40),t.TgZ(2,"em"),t._uU(3,"Saved"),t.qZA()())}function O(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"button",41),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,l=t.oxw();return t.KtG(l.removeRow(i))}),t._UZ(1,"i",42),t._uU(2,"Remove entry "),t.qZA()}}const h=function(a){return["/","app","talent","view",a]};function W(a,s){if(1&a&&(t.TgZ(0,"a",43),t._uU(1," View in new tab "),t.qZA()),2&a){const e=t.oxw().$implicit;t.Q6J("routerLink",t.VKq(1,h,null==e.saved?null:e.saved._id))}}function $(a,s){1&a&&(t.TgZ(0,"span"),t._uU(1," This form has not been completed yet "),t.qZA())}function G(a,s){1&a&&(t.TgZ(0,"span"),t._uU(1," There was a problem in the server while saving this talent "),t.qZA())}function K(a,s){if(1&a&&(t.TgZ(0,"div",44),t.YNc(1,$,2,0,"span",19),t.YNc(2,G,2,0,"span",19),t.qZA()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf","INCOMPLETE"==e.error),t.xp6(1),t.Q6J("ngIf","SERVER_ERROR"==e.error)}}function H(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"button",45),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.removeLegacyWorkInfoSection())}),t._UZ(1,"i",46),t._uU(2,"Remove Employment "),t.qZA()}}function P(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"employment-forms-add-legacy-work",47),t.NdJ("valueChanges",function(i){t.CHM(e);const l=t.oxw().$implicit;return t.KtG(l.currentLegacyWorkValue=i)})("statusChanges",function(i){t.CHM(e);const l=t.oxw().$implicit;return t.KtG(l.legacyWorkStatus=i)}),t.qZA()}if(2&a){const e=t.oxw().$implicit,n=t.oxw();t.Q6J("disabled",e.disabled)("positionOptions",n.positionOptions)("propertyOptions",n.propertyOptions)("touchForm",e.touch)}}function D(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"button",45),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.removeAccountSection())}),t._UZ(1,"i",48),t._uU(2,"Remove Keiro Access "),t.qZA()}}function q(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"keiro-account-form",49),t.NdJ("valueChanges",function(i){t.CHM(e);const l=t.oxw().$implicit;return t.KtG(l.currentAccountValue=i)})("statusChanges",function(i){t.CHM(e);const l=t.oxw().$implicit;return t.KtG(l.accountStatus=i)}),t.qZA()}if(2&a){const e=t.oxw().$implicit,n=t.oxw();t.Q6J("disabled",e.disabled)("touchForm",e.touch)("canCreateRoles",n.canCreateRoles)}}function j(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"button",53),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2).$implicit;return t.KtG(i.addLegacyWorkInfoSection())}),t._UZ(1,"i",46),t._uU(2,"Add Employment "),t.qZA()}}function B(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"button",54),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2).$implicit;return t.KtG(i.addAccountSection())}),t._UZ(1,"i",55),t._uU(2,"Grant Keiro Access "),t.qZA()}}function z(a,s){if(1&a&&(t.TgZ(0,"div",50),t.YNc(1,j,3,0,"button",51),t.YNc(2,B,3,0,"button",52),t.qZA()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",!e.showLegacyWorkInfo),t.xp6(1),t.Q6J("ngIf",e.canManageAccounts&&!e.showAlastaAccountSection)}}const X=function(a,s){return{"fa-chevron-up":a,"fa-chevron-down":s}};function tt(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"div")(1,"div",12)(2,"div",13)(3,"div",14)(4,"div",15)(5,"button",16),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.KtG(l.formVisible=!l.formVisible)}),t.TgZ(6,"h6",17),t._UZ(7,"i",18),t.qZA()()(),t.TgZ(8,"div",4)(9,"em"),t._uU(10),t.qZA(),t.YNc(11,R,3,2,"span",19),t.YNc(12,Y,4,0,"div",20),t.qZA(),t.TgZ(13,"div",21),t.YNc(14,O,3,0,"button",22),t.YNc(15,W,2,3,"a",23),t.qZA()(),t.TgZ(16,"div",24),t.YNc(17,K,3,2,"div",25),t.TgZ(18,"div",26)(19,"h6",27),t._uU(20,"General information"),t.qZA(),t.TgZ(21,"talent-form",28),t.NdJ("valueChanges",function(i){const c=t.CHM(e).$implicit;return t.KtG(c.currentTalentValue=i)})("statusChanges",function(i){const c=t.CHM(e).$implicit;return t.KtG(c.talentStatus=i)}),t.qZA()(),t.TgZ(22,"div",29),t._UZ(23,"hr",30),t.TgZ(24,"h6",27),t._uU(25," Employment "),t.YNc(26,H,3,0,"button",31),t.qZA(),t.YNc(27,P,1,4,"employment-forms-add-legacy-work",32),t.qZA(),t.TgZ(28,"div",33),t._UZ(29,"hr",30),t.TgZ(30,"h6",27),t._uU(31," Keiro Account "),t.YNc(32,D,3,0,"button",31),t.qZA(),t.YNc(33,q,1,3,"keiro-account-form",34),t.qZA(),t.YNc(34,z,3,2,"div",35),t.qZA()()()()}if(2&a){const e=s.$implicit,n=s.index,i=t.oxw();t.xp6(1),t.Q6J("ngClass",e.cssClass),t.xp6(4),t.Udp("font-size",100,"%"),t.xp6(2),t.Q6J("ngClass",t.WLB(29,X,e.formVisible,!e.formVisible)),t.xp6(3),t.hij("Talent form #",n+1,""),t.xp6(1),t.Q6J("ngIf",!e.formVisible),t.xp6(1),t.Q6J("ngIf",e.saved),t.xp6(2),t.Q6J("ngIf",!e.saved),t.xp6(1),t.Q6J("ngIf",e.saved),t.xp6(1),t.Q6J("collapse",!e.formVisible)("isAnimated",!0),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(4),t.Q6J("disabled",e.disabled)("allNationalities",i.allNationalities)("allLanguages",i.allLanguages)("touchForm",e.touch),t.xp6(1),t.Q6J("collapse",!e.showLegacyWorkInfo)("isAnimated",!0),t.xp6(1),t.Udp("width",85,"%"),t.xp6(3),t.Q6J("ngIf",!e.saved),t.xp6(1),t.Q6J("ngIf",e.showLegacyWorkInfo),t.xp6(1),t.Q6J("collapse",!e.showAlastaAccountSection)("isAnimated",!0),t.xp6(1),t.Udp("width",85,"%"),t.xp6(3),t.Q6J("ngIf",e.canManageAccounts&&!e.saved),t.xp6(1),t.Q6J("ngIf",e.showAlastaAccountSection),t.xp6(1),t.Q6J("ngIf",!e.saved)}}function et(a,s){if(1&a&&(t.TgZ(0,"li",61)(1,"div",14)(2,"div",4),t._uU(3),t.qZA(),t.TgZ(4,"div",15)(5,"a",62),t._uU(6,"View talent in new tab"),t.qZA()()()()),2&a){const e=s.$implicit;t.xp6(3),t.AsE(" ",null==e.saved||null==e.saved.name?null:e.saved.name.given," ",null==e.saved||null==e.saved.name?null:e.saved.name.last," "),t.xp6(2),t.Q6J("routerLink",t.VKq(3,h,null==e||null==e.saved?null:e.saved._id))}}function nt(a,s){if(1&a&&(t.TgZ(0,"div",58)(1,"h6",27),t._uU(2),t.qZA(),t.TgZ(3,"ul",59),t.YNc(4,et,7,5,"li",60),t.qZA()()),2&a){const e=t.oxw(2);t.xp6(2),t.hij("Saved talents (",e.savedTalents.length,")"),t.xp6(2),t.Q6J("ngForOf",e.savedTalents)}}function at(a,s){if(1&a){const e=t.EpF();t.TgZ(0,"bulk-save-progress-modal",56),t.NdJ("close",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.closeModal())}),t.YNc(1,nt,5,2,"div",57),t.qZA()}if(2&a){const e=t.oxw();t.Q6J("progress",e.savingProgress),t.xp6(1),t.Q6J("ngIf",0!==(null==e.savedTalents?null:e.savedTalents.length))}}class st{constructor(s){this.formVisible=!0,this.disabled=!1,this.defaultCssClass="border-secondary",this.cssClass=this.defaultCssClass,this.touch=new t.vpe,this.canManageAccounts=!0,this.showAlastaAccountSection=!1,this.showLegacyWorkInfo=!0,0===s.length&&(this.canManageAccounts=!1)}set currentTalentValue(s){this.error=void 0,this._currentTalentValue=s}get currentTalentValue(){return this._currentTalentValue}set talentStatus(s){this._talentStatus=s,this.updateCssClass()}set currentAccountValue(s){this.error=void 0,this._currentAccountValue=s}get currentAccountValue(){return this._currentAccountValue}set accountStatus(s){this._accountStatus=s,this.updateCssClass()}set currentLegacyWorkValue(s){this.error=void 0,this._currentLegacyWorkValue=s}get currentLegacyWorkValue(){return this._currentLegacyWorkValue}set legacyWorkStatus(s){this._legacyWorkStatus=s,this.updateCssClass()}addAccountSection(){this.showAlastaAccountSection=!0,this.updateCssClass()}removeAccountSection(){this.showAlastaAccountSection=!1,this.updateCssClass()}addLegacyWorkInfoSection(){this.showLegacyWorkInfo=!0,this.updateCssClass()}removeLegacyWorkInfoSection(){this.showLegacyWorkInfo=!1,this.updateCssClass()}updateCssClass(){"INVALID"!==this.getSimplifiedStatus()?this.saved?setTimeout(()=>{this.cssClass="border-success"}):setTimeout(()=>{this.cssClass=this.defaultCssClass}):setTimeout(()=>{this.cssClass="border-danger"})}getSimplifiedStatus(){return this.showAlastaAccountSection&&"INVALID"===this._accountStatus||this.showLegacyWorkInfo&&"INVALID"===this._legacyWorkStatus||"INVALID"===this._talentStatus?"INVALID":this._talentStatus}}let it=(()=>{class a{constructor(e,n,i,l,c,ct,ut,dt){this.router=e,this.authStateService=n,this.talentManagementServiceApi=i,this.modalsController=l,this.sessionStateService=c,this.locationsApi=ct,this.positionsApi=ut,this.teamServiceApi=dt,this.inputTalentForms=[],this.allLanguages=[],this.allNationalities=[],this.positionOptions=[],this.propertyOptions=[],this.canCreateRolesString=[],this.canCreateRoles=[],this.canHideForm=!0,this.canHideAccountSection=!1,this.talentsToAddQueue=[],this.savingProgress=new p.j(0),this.savedTalents=[],this.subscriptions=new Z.w0,this.subscriptions.add(this.authStateService.authState.subscribe(v=>{if(v.identity){if(this.currentUser=v.identity,"Admin"==this.currentUser.role)return void(this.canCreateRoles=[r.u.EMPLOYEE,r.u.MANAGER,r.u.ADMIN]);if("Manager"==this.currentUser.role)return void(this.canCreateRoles=[r.u.EMPLOYEE]);if("SuperAdmin"==this.currentUser.role)return void(this.canCreateRoles=[r.u.EMPLOYEE,r.u.MANAGER,r.u.ADMIN])}}))}ngOnInit(){var e=this;return(0,u.Z)(function*(){Promise.all([e.getAllLanguages(),e.getAllNationalities(),e.fetchLocations(),e.fetchPositions()]).then(n=>e.addNewRow()).catch(n=>e.handleFatalError())})()}ngOnDestroy(){this.subscriptions.unsubscribe()}prettifyError(e){return e?e.required?"Required":e.min||e.max?"Invalid":e.notInteger||e.notNumeric?"Not number":e.valueNotInOptions?"Unknown value":e.email?"Not valid email address":e.emailInUse?`Email address already in use by ${e.associatedTalent}`:e.minlength||e.maxlength?"Invalid length":e.matDatepickerMin||e.matDatepickerMax?"Invalid date":e.allOrNothing?"Incomplete work information":"":""}addNewRow(){this.sessionStateService.registerActivity();let e=new st(this.canCreateRoles);this.inputTalentForms.push(e)}removeRow(e){this.sessionStateService.registerActivity();const n=this.inputTalentForms.indexOf(e);this.inputTalentForms.splice(n,1);const i=this.savedTalents.indexOf(e);-1!=i&&this.savedTalents.splice(i,1)}ifTalentValueSet(e,n){return void 0!==e.currentTalentValue&&g.g.hasValue(e.currentTalentValue[n])}ifAccountValueSet(e,n){return void 0!==e.currentAccountValue&&g.g.hasValue(e.currentAccountValue[n])}saveTalents(e){this.sessionStateService.registerActivity(),this.talentsToAddQueue=this.inputTalentForms.filter(n=>!n.saved).map(n=>(n.error=void 0,n.touch.emit(),n)),this.savingProgress=new p.j(this.talentsToAddQueue.length),this.modalsController.openModal(e,{ignoreBackdropClick:!0,keyboard:!1}),this.saveNextTalent()}saveNextTalent(){var e=this;return(0,u.Z)(function*(){if(e.sessionStateService.registerActivity(),0==e.talentsToAddQueue.length)return;const n=e.talentsToAddQueue.shift();if(void 0!==n){if("VALID"!==n.getSimplifiedStatus())return n.error="INCOMPLETE",e.handleSaveFail(),void e.saveNextTalent();if(void 0!==n.currentTalentValue)try{const i=yield e.talentManagementServiceApi.createTalent(n.currentTalentValue,n.currentAccountValue);n.saved=i.talent,n.formVisible=!1,n.disabled=!0,n.showLegacyWorkInfo&&void 0!==n.currentLegacyWorkValue&&(yield e.teamServiceApi.addJobEmployment(n.currentLegacyWorkValue.propertyId,n.currentLegacyWorkValue.positionId,i.talent._id,n.currentLegacyWorkValue.startDate)),e.handleSaveSuccess(n),e.savedTalents.push(n)}catch{n.error="SERVER_ERROR",e.handleSaveFail()}finally{e.saveNextTalent()}}})()}handleSaveSuccess(e){this.savingProgress.incrementSuccessful(),e.disabled=!0}handleSaveFail(){this.savingProgress.incrementFailed()}handleFatalError(){alert("An error ocurred, please try again"),this.router.navigate(["app/talent/finder"])}closeModal(){this.modalsController.closeUpperModal()}getAllLanguages(){var e=this;return(0,u.Z)(function*(){const n=yield e.talentManagementServiceApi.getSupportedLanguages();e.allLanguages=n.languages})()}getAllNationalities(){var e=this;return(0,u.Z)(function*(){const n=yield e.talentManagementServiceApi.getSupportedCountries();e.allNationalities=n.countries})()}fetchLocations(){var e=this;return(0,u.Z)(function*(){const n=yield e.locationsApi.getAllProperties();e.propertyOptions=n.properties})()}fetchPositions(){var e=this;return(0,u.Z)(function*(){const n=yield e.positionsApi.getAllPositions();e.positionOptions=n.positions})()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(m.F0),t.Y36(S.V),t.Y36(I.C),t.Y36(k.l),t.Y36(N.W),t.Y36(F._),t.Y36(V.m),t.Y36(w.U))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-create-talent"]],decls:17,vars:3,consts:[[1,"animated","fadeIn"],[1,"card"],[1,"card-body"],[1,"form-row","mb-2"],[1,"col"],[1,"col-auto","col-sm-4"],["title","Save list of talents",1,"btn","btn-block","btn-success",3,"disabled","click"],["aria-hidden","true",1,"fa","fa-paper-plane","mr-1"],[4,"ngFor","ngForOf"],[1,"mt-2","mb-1","btn","btn-secondary",3,"click"],["aria-hidden","true",1,"fa","fa-plus","mr-1"],["savingInProcessModal",""],[1,"align-items-center","border","rounded","my-1","shadow-sm",3,"ngClass"],[1,"col","my-3"],[1,"form-row"],[1,"col-auto"],[1,"btn","btn-light","rounded-pill","text-center",3,"click"],[1,"m-0","p-0"],["aria-hidden","true",1,"fa",3,"ngClass"],[4,"ngIf"],["class","ml-1 d-inline-block text-success",4,"ngIf"],[1,"col-12","col-sm-auto","text-right"],["class","btn btn-sm btn-outline-danger","title","Remove this entry",3,"click",4,"ngIf"],["class","btn btn-link","target","_blank",3,"routerLink",4,"ngIf"],[1,"pt-2",3,"collapse","isAnimated"],["id","formError","class","p-error block",4,"ngIf"],["id","generalInfoSection"],[1,"mb-0"],[3,"disabled","allNationalities","allLanguages","touchForm","valueChanges","statusChanges"],["id","legacyWorkSection",3,"collapse","isAnimated"],[1,"my-2"],["class","btn btn-sm btn-outline-danger",3,"click",4,"ngIf"],[3,"disabled","positionOptions","propertyOptions","touchForm","valueChanges","statusChanges",4,"ngIf"],["id","accountSection",3,"collapse","isAnimated"],[3,"disabled","touchForm","canCreateRoles","valueChanges","statusChanges",4,"ngIf"],["id","sectionsControl","class","mt-2",4,"ngIf"],["class","mx-1",4,"ngIf"],[1,"mx-1"],["accentLevel","warning","iconClasses","fa fa-exclamation-circle","tooltipMessage","This talent form has not been completed yet"],[1,"ml-1","d-inline-block","text-success"],["aria-hidden","true",1,"fa","fa-check","mr-1"],["title","Remove this entry",1,"btn","btn-sm","btn-outline-danger",3,"click"],["aria-hidden","true",1,"fa","fa-minus","mr-1"],["target","_blank",1,"btn","btn-link",3,"routerLink"],["id","formError",1,"p-error","block"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],["aria-hidden","true",1,"fa","fa-briefcase","mr-1"],[3,"disabled","positionOptions","propertyOptions","touchForm","valueChanges","statusChanges"],["aria-hidden","true",1,"fa","fa-door-closed","mr-1"],[3,"disabled","touchForm","canCreateRoles","valueChanges","statusChanges"],["id","sectionsControl",1,"mt-2"],["class","btn btn-sm btn-outline-primary mr-1",3,"click",4,"ngIf"],["class","btn btn-sm btn-outline-primary",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-outline-primary","mr-1",3,"click"],[1,"btn","btn-sm","btn-outline-primary",3,"click"],["aria-hidden","true",1,"fa","fa-door-open","mr-1"],["savingResource","talent",3,"progress","close"],["class","my-2 p-1",4,"ngIf"],[1,"my-2","p-1"],[1,"list-group","list-group-flush","mb-2"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["target","_blank",3,"routerLink"]],template:function(e,n){if(1&e){const i=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4"),t._uU(6,"New talents"),t.qZA()(),t.TgZ(7,"div",5)(8,"button",6),t.NdJ("click",function(){t.CHM(i);const c=t.MAs(16);return t.KtG(n.saveTalents(c))}),t._UZ(9,"i",7),t._uU(10),t.qZA()()(),t.YNc(11,tt,35,32,"div",8),t.TgZ(12,"button",9),t.NdJ("click",function(){return n.addNewRow()}),t._UZ(13,"i",10),t._uU(14,"Add a new entry "),t.qZA()()()(),t.YNc(15,at,2,2,"ng-template",null,11,t.W1O)}2&e&&(t.xp6(8),t.Q6J("disabled",0==n.inputTalentForms.length),t.xp6(2),t.hij("Save talents (",n.inputTalentForms.length-n.savedTalents.length,") "),t.xp6(1),t.Q6J("ngForOf",n.inputTalentForms))},dependencies:[m.yS,d.mk,d.sg,d.O5,f.Y,p.n,L.s,M.V,J.g,E.e],encapsulation:2}),a})();var ot=o(2342),lt=o(3920);let rt=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[m.Bz.forChild([{path:"",component:it}]),d.ez,T.UX,f.f,C.HC.forRoot(),A.z8,x.t,y.k,b.B,ot.M,lt.y]}),a})()}}]);