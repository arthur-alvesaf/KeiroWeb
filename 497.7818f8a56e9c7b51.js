"use strict";(self.webpackChunkalasta_ui=self.webpackChunkalasta_ui||[]).push([[497],{2497:($,Z,s)=>{s.r(Z),s.d(Z,{CreateReviewModule:()=>Q});var v=s(9808),a=s(2382),u=s(7322),x=s(7531),A=s(4107),C=s(7311),b=s(1217),_=s(2306),c=s(1035),I=s(727),S=s(9300),h=s(2027),p=s(826),m=s(1658),l=s(582),e=s(5e3),y=s(18),q=s(921),U=s(508);function E(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"div",7),e.TgZ(2,"p",8),e._uU(3,"No talents currently selected"),e.qZA(),e.TgZ(4,"button",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().goToTalentFinder()}),e._uU(5,"Select talents in Talent Finder"),e.qZA(),e.qZA(),e.qZA()}}function N(o,n){if(1&o&&(e.TgZ(0,"p",31),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.formGroup.errors.notSaved.message)}}function D(o,n){if(1&o&&(e.TgZ(0,"p",19),e.TgZ(1,"strong",20),e._uU(2,"Position:"),e.qZA(),e._uU(3),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(3),e.Oqu(t.talentInfo.position)}}function Y(o,n){if(1&o&&(e.TgZ(0,"p",19),e.TgZ(1,"strong",20),e._uU(2,"Property:"),e.qZA(),e._uU(3),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(3),e.Oqu(t.talentInfo.location)}}function F(o,n){if(1&o&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.display)}}const G=function(o){return{"border-danger":o}};function P(o,n){if(1&o&&(e.TgZ(0,"div",15),e.TgZ(1,"div",16),e.YNc(2,N,2,1,"p",17),e.TgZ(3,"div",18),e.TgZ(4,"p",19),e.TgZ(5,"strong",20),e._uU(6,"Name:"),e.qZA(),e._uU(7),e.qZA(),e.YNc(8,D,4,1,"p",21),e.YNc(9,Y,4,1,"p",21),e.qZA(),e.TgZ(10,"div",22),e.TgZ(11,"form",23),e.TgZ(12,"div",24),e.TgZ(13,"div",25),e.TgZ(14,"mat-label",26),e._UZ(15,"br"),e.qZA(),e.TgZ(16,"mat-form-field",27),e.TgZ(17,"mat-label"),e._uU(18,"Performance Score %"),e.qZA(),e._UZ(19,"input",28),e.TgZ(20,"mat-error"),e._uU(21),e.qZA(),e.qZA(),e.qZA(),e.TgZ(22,"div",25),e.TgZ(23,"mat-label",26),e._UZ(24,"br"),e.qZA(),e.TgZ(25,"mat-form-field",27),e.TgZ(26,"mat-label"),e._uU(27,"Potential Score"),e.qZA(),e.TgZ(28,"mat-select",29),e.YNc(29,F,2,2,"mat-option",30),e.qZA(),e.TgZ(30,"mat-error"),e._uU(31),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o){const t=n.$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("ngClass",e.VKq(15,G,t.formGroup.touched&&t.formGroup.errors)),e.xp6(1),e.Q6J("ngIf",t.formGroup.hasError("notSaved")&&t.formGroup.errors.notSaved.message),e.xp6(5),e.Oqu(t.talentInfo.name),e.xp6(1),e.Q6J("ngIf",t.talentInfo.position),e.xp6(1),e.Q6J("ngIf",t.talentInfo.location),e.xp6(2),e.Q6J("formGroup",t.formGroup),e.xp6(5),e.Udp("width",100,"%"),e.xp6(3),e.hYB("placeholder","",i.reviewValidRanges.per.min+1," - ",i.reviewValidRanges.per.max,"%"),e.xp6(2),e.Oqu(i.prettifyError(t.formGroup.controls.performanceScore.errors)),e.xp6(4),e.Udp("width",100,"%"),e.xp6(4),e.Q6J("ngForOf",i.potentialRanges),e.xp6(2),e.Oqu(i.prettifyError(t.formGroup.controls.potentialScore.errors))}}function W(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",10),e.TgZ(1,"div",11),e.TgZ(2,"p",12),e._uU(3,"Currently saving reviews for the review cycle: "),e.TgZ(4,"b"),e._uU(5),e.qZA(),e._uU(6),e.qZA(),e.TgZ(7,"p"),e._uU(8),e.qZA(),e.qZA(),e.YNc(9,P,32,17,"div",13),e.TgZ(10,"button",14),e.NdJ("click",function(){e.CHM(t);const d=e.oxw(),T=e.MAs(8);return d.saveTalents(T)}),e._uU(11,"Save reviews"),e.qZA(),e.qZA()}if(2&o){const t=e.oxw();e.xp6(5),e.Oqu(null==t.currentReviewWindow?null:t.currentReviewWindow.name),e.xp6(1),e.hij(" on ",t.today,"."),e.xp6(2),e.hij("The last day for saving reviews in the current cycle is: ",null==t.currentReviewWindow?null:t.currentReviewWindow.endDate,"."),e.xp6(1),e.Q6J("ngForOf",t.talentsToReview),e.xp6(1),e.Q6J("disabled",-1!=t.queueResponseTalentIdx||0==t.talentsToReview.length)}}function J(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"bulk-save-progress-modal",33),e.NdJ("close",function(){return e.CHM(t),e.oxw().closeProgressModal()}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("progress",t.savingProgress)}}class O{constructor(n,t,i,d){this.customValidators=new m.d,this.talentInfo=n,this.formGroup=t,this.dateOfReview=d,this.formGroup.setValidators([m.d.isWithinDates(i.startDate,i.endDate,d)])}simplify(){var n,t;let i={};return this.formGroup.markAllAsTouched(),i.valid=this.formGroup.valid,i.id=this.talentInfo.id,i.performanceScore=null===(n=this.formGroup.get("performanceScore"))||void 0===n?void 0:n.value,i.potentialScore=null===(t=this.formGroup.get("potentialScore"))||void 0===t?void 0:t.value,i.dateOfReview=this.dateOfReview.date,i}}let V=(()=>{class o{constructor(t,i,d,T,g,M){this.modalService=t,this.router=i,this.fb=d,this.sessionStateService=T,this.store=g,this.actionDispatcher=M,this.today=new h.p,this.talentsToReview=[],this.potentialRanges=[{value:1,display:"Low"},{value:2,display:"Medium"},{value:3,display:"High"}],this.reviewValidRanges={per:{min:0,max:0},pot:{min:0,max:0}},this.subscriptions=new I.w0,this.talentsToReviewQueue=[],this.queueResponseTalentIdx=-1,this.savingProgress=new l.jh(0),this.talentManagement$=g.pipe((0,c.Ys)("talentManagementState")),this.dashboard$=g.pipe((0,c.Ys)("dashboardState")),this.reviewWindow$=g.pipe((0,c.Ys)("reviewWindowState")),this.subscriptions.add(this.dashboard$.subscribe(r=>{r.boxesInfo[2]&&(this.reviewValidRanges.per.max=r.boxesInfo[2].perRng.high,this.reviewValidRanges.pot.max=r.boxesInfo[2].potRng.high),r.boxesInfo[6]&&(this.reviewValidRanges.per.min=r.boxesInfo[6].perRng.low,this.reviewValidRanges.pot.min=r.boxesInfo[6].potRng.low)})),this.subscriptions.add(this.reviewWindow$.subscribe(r=>{this.currentReviewWindow=r.currentWindowReview||void 0})),this.subscriptions.add(this.talentManagement$.subscribe(r=>{this.talentsToReview=r.selectedTalents.map(f=>{var w,R;return new O(f,this.fb.group({performanceScore:["",[a.kI.required,m.d.isInteger(),a.kI.min(this.reviewValidRanges.per.min+1),a.kI.max(this.reviewValidRanges.per.max)]],potentialScore:["",[a.kI.required,m.d.isInteger(),a.kI.min(this.reviewValidRanges.pot.min),a.kI.max(this.reviewValidRanges.pot.max)]]}),{startDate:(null===(w=this.currentReviewWindow)||void 0===w?void 0:w.startDate)||new h.p,endDate:(null===(R=this.currentReviewWindow)||void 0===R?void 0:R.endDate)||new h.p},this.today)})}));let L=[p.Yc.ADD_TALENT_REVIEW_SUCCESS,p.Yc.ADD_TALENT_REVIEW_FAILURE];this.subscriptions.add(this.actionDispatcher.pipe((0,S.h)(r=>L.includes(r.type))).subscribe(r=>{let f=this.talentsToReview[this.queueResponseTalentIdx];r.type==p.Yc.ADD_TALENT_REVIEW_SUCCESS&&(this.savingProgress.successful++,this.savingProgress.progressBarDisplay[l.CX.SUCCESS].value++,f.formGroup.disable()),r.type==p.Yc.ADD_TALENT_REVIEW_FAILURE&&(this.savingProgress.failed++,this.savingProgress.progressBarDisplay[l.CX.FAILURE].value++,f.formGroup.setErrors({notSaved:{message:"There was a problem saving this review"}})),this.saveNextTalent()})),this.subscriptions.add(this.sessionStateService.onSessionDestroyed.subscribe(r=>{this.modalRef&&this.modalRef.hide()}))}ngOnDestroy(){this.store.dispatch((0,p.XA)()),this.subscriptions.unsubscribe()}goToTalentFinder(){this.router.navigate(["app","talent","finder"])}prettifyError(t){return t?t.required?"Required":t.min||t.max?"Invalid":t.notNumeric?"Not number":t.notInteger?"Contains decimal":"":""}saveNextTalent(){if(this.savingProgress.pending--,0==this.talentsToReviewQueue.length)return this.queueResponseTalentIdx=-1,this.talentsToReviewQueue=[],void(this.savingProgress.status=l.Wg.FINISHED);this.queueResponseTalentIdx++;const t=this.talentsToReviewQueue.shift();t.valid?this.store.dispatch((0,p.YT)({talentReview:t})):(this.savingProgress.failed++,this.savingProgress.progressBarDisplay[l.CX.FAILURE].value++,this.talentsToReview[this.queueResponseTalentIdx].formGroup.setErrors({notSaved:{message:"This form has not been completed yet"}}),this.saveNextTalent())}saveTalents(t){this.talentsToReviewQueue=this.talentsToReview.map(i=>i.simplify()),this.savingProgress=new l.jh(this.talentsToReviewQueue.length),this.savingProgress.status=l.Wg.IN_PROGRESS,this.modalRef=this.modalService.show(t,{ignoreBackdropClick:!0,keyboard:!1}),this.saveNextTalent()}closeProgressModal(){var t;null===(t=this.modalRef)||void 0===t||t.hide(),this.talentsToReview=this.talentsToReview.filter(i=>i.formGroup.hasError("notSaved"))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(y.tT),e.Y36(C.F0),e.Y36(a.qu),e.Y36(q.W),e.Y36(c.yh),e.Y36(c.mK))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-create-review"]],decls:9,vars:2,consts:[[1,"animated","fadeIn"],[1,"card"],[1,"card-body"],["class","row",4,"ngIf"],["class","row px-3",4,"ngIf"],["savingInProcessModal",""],[1,"row"],[1,"col","text-center"],[1,"mb-1"],[1,"btn","btn-block","btn-primary",3,"click"],[1,"row","px-3"],[1,"col-12","border","rounded","border-warning"],[1,"py-2","m-0"],["class","col-12",4,"ngFor","ngForOf"],["title","Save reviews for talents",1,"btn","btn-block","btn-success",3,"disabled","click"],[1,"col-12"],[1,"row","align-items-center","border","border-secondary","shadow-sm","rounded","py-2","my-1",3,"ngClass"],["class","col-12 m-0 text-danger",4,"ngIf"],[1,"col-12","col-md-6","col-lg-4"],[1,"m-0","p-0"],[1,"pr-1"],["class","m-0 p-0",4,"ngIf"],[1,"col-12","col-md-6","col-lg-8"],["autocomplete","off",3,"formGroup"],[1,"form-row","align-items-center"],[1,"col-12","col-sm-6","col-md-6"],[1,"d-block"],["appearance","outline"],["type","number","formControlName","performanceScore","matInput","","autocomplete","off","name","performanceScore",3,"placeholder"],["formControlName","potentialScore"],[3,"value",4,"ngFor","ngForOf"],[1,"col-12","m-0","text-danger"],[3,"value"],["savingResource","review",3,"progress","close"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"h4"),e._uU(4,"Add reviews"),e.qZA(),e.YNc(5,E,6,0,"div",3),e.YNc(6,W,12,5,"div",4),e.qZA(),e.qZA(),e.qZA(),e.YNc(7,J,1,1,"ng-template",null,5,e.W1O)),2&t&&(e.xp6(5),e.Q6J("ngIf",!i.talentsToReview.length),e.xp6(1),e.Q6J("ngIf",i.talentsToReview.length))},directives:[v.O5,v.sg,v.mk,a._Y,a.JL,a.sg,u.hX,u.KE,a.wV,a.Fj,x.Nt,a.JJ,a.u,u.TO,A.gD,U.ey,l.ng],encapsulation:2}),o})(),Q=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[C.Bz.forChild([{path:"",component:V}]),v.ez,a.UX,u.lN,x.c,A.LD,b.HC.forRoot(),_.t]]}),o})()}}]);