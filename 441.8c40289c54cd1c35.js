"use strict";(self.webpackChunkalasta_ui=self.webpackChunkalasta_ui||[]).push([[441],{6441:(S,E,r)=>{r.r(E),r.d(E,{ReviewsModule:()=>V});var s=r(6895),v=r(433),_=r(9549),b=r(4144),C=r(4789),y=r(4358),T=r(4175),f=r(585),h=r(1740),g=r(9014),e=r(1571);function R(n,p){1&n&&(e.TgZ(0,"span"),e._uU(1,"Add "),e.qZA())}function l(n,p){1&n&&(e.TgZ(0,"span"),e._uU(1,"Edit "),e.qZA())}function u(n,p){if(1&n&&(e.TgZ(0,"div",13)(1,"form",14)(2,"div",15)(3,"div",16)(4,"h6",17),e._uU(5,"Review cycle name"),e.qZA(),e.TgZ(6,"div",18),e._UZ(7,"input",19),e.qZA()(),e.TgZ(8,"div",16)(9,"h6",17),e._uU(10,"Cycle Start Date"),e.qZA(),e.TgZ(11,"div",18),e._UZ(12,"p-calendar",20),e.qZA()(),e.TgZ(13,"div",16)(14,"h6",17),e._uU(15,"Cycle End Date"),e.qZA(),e.TgZ(16,"div",18),e._UZ(17,"p-calendar",21),e.qZA()()()()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.addEditForm),e.xp6(11),e.Q6J("showIcon",!0)("minDate",t.today)("disabled",t.hasStarted),e.xp6(5),e.Q6J("showIcon",!0)("minDate",t.today)}}function a(n,p){if(1&n){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return o.processing=!0,e.KtG(o.onDeleteClick.emit())}),e._UZ(1,"i",23),e._uU(2," Delete "),e.qZA()}}function c(n,p){1&n&&(e.TgZ(0,"span"),e._uU(1,"Add new cycle"),e.qZA())}function x(n,p){1&n&&(e.TgZ(0,"span"),e._uU(1,"Update cycle details"),e.qZA())}let D=(()=>{class n{constructor(t){this.fb=t,this.addingReviewCycle=!0,this.hasStarted=!1,this.canBeDeleted=!1,this.processing=!1,this.onSumbit=new e.vpe,this.onCloseModal=new e.vpe,this.onDeleteClick=new e.vpe,this.today=new Date}ngOnInit(){this.addEditForm=this.fb.group({name:[this.existing?.name,v.kI.required],startDate:[this.existing?.startDate.date,v.kI.required],endDate:[this.existing?.endDate.date,v.kI.required]}),this.existing?._id&&(this.addingReviewCycle=!1,this.hasStarted=!!this.existing.hasStarted&&this.existing.hasStarted,this.canBeDeleted=!this.hasStarted)}getFormValue(){let t=this.addEditForm?.value.name,i=this.addEditForm?.value.startDate,o=this.addEditForm?.value.endDate;return o.setHours(23),o.setMinutes(59),{...this.existing?._id?{_id:this.existing?._id}:{},...this.existing?.name===t?{}:{name:t},...this.existing?.startDate?.date?.valueOf()===i?.valueOf()?{}:{startDate:i},...this.existing?.endDate?.date?.valueOf()===o?.valueOf()?{}:{endDate:o}}}clearTalentFromForm(){this.addEditForm?.get("name")?.setValue(null),this.addEditForm?.get("name")?.markAsPristine(),this.addEditForm?.get("startDate")?.setValue(null),this.addEditForm?.get("startDate")?.markAsPristine(),this.addEditForm?.get("endDate")?.setValue(null),this.addEditForm?.get("endDate")?.markAsPristine()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(v.QS))},n.\u0275cmp=e.Xpm({type:n,selectors:[["reviews-add-edit-review-cycle-modal"]],inputs:{existing:"existing",processing:"processing"},outputs:{onSumbit:"onSumbit",onCloseModal:"onCloseModal",onDeleteClick:"onDeleteClick"},decls:20,vars:7,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],[4,"ngIf"],["type","button","aria-label","Close",1,"close","pull-right",3,"click"],["aria-hidden","true"],["class","modal-body",4,"ngIf"],[1,"modal-footer"],[1,"text-right"],["class","btn btn-danger",3,"click",4,"ngIf"],[1,"btn","btn-primary","ml-1",3,"click"],["aria-hidden","true",1,"fa","fa-times"],[1,"btn","btn-secondary","ml-1",3,"disabled","click"],["aria-hidden","true",1,"fa","fa-edit"],[1,"modal-body"],[3,"formGroup"],[1,"form-row"],[1,"col-12"],[1,"mb-0"],[1,"p-fluid"],["type","text","pInputText","","formControlName","name"],["formControlName","startDate","dateFormat","dd M yy","icon","fas fa-calendar-alt",3,"showIcon","minDate","disabled"],["formControlName","endDate","dateFormat","dd M yy","icon","fas fa-calendar-alt",3,"showIcon","minDate"],[1,"btn","btn-danger",3,"click"],["aria-hidden","true",1,"fa","fa-trash-alt"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"h4",1)(2,"span"),e.YNc(3,R,2,0,"span",2),e.YNc(4,l,2,0,"span",2),e._uU(5," Review Cycle "),e.qZA()(),e.TgZ(6,"button",3),e.NdJ("click",function(d){return i.onCloseModal.emit(d)}),e.TgZ(7,"span",4),e._uU(8,"\xd7"),e.qZA()()(),e.YNc(9,u,18,6,"div",5),e.TgZ(10,"div",6)(11,"div",7),e.YNc(12,a,3,0,"button",8),e.TgZ(13,"button",9),e.NdJ("click",function(d){return i.clearTalentFromForm(),i.onCloseModal.emit(d)}),e._UZ(14,"i",10),e._uU(15," Cancel "),e.qZA(),e.TgZ(16,"button",11),e.NdJ("click",function(){return i.processing=!0,i.onSumbit.emit(i.getFormValue())}),e._UZ(17,"i",12),e.YNc(18,c,2,0,"span",2),e.YNc(19,x,2,0,"span",2),e.qZA()()()),2&t&&(e.xp6(3),e.Q6J("ngIf",i.addingReviewCycle),e.xp6(1),e.Q6J("ngIf",!i.addingReviewCycle),e.xp6(5),e.Q6J("ngIf",i.addEditForm),e.xp6(3),e.Q6J("ngIf",i.canBeDeleted),e.xp6(4),e.Q6J("disabled",(null==i.addEditForm?null:i.addEditForm.invalid)||(null==i.addEditForm?null:i.addEditForm.pristine)),e.xp6(2),e.Q6J("ngIf",i.addingReviewCycle),e.xp6(1),e.Q6J("ngIf",!i.addingReviewCycle))},dependencies:[s.O5,v._Y,v.Fj,v.JJ,v.JL,v.sg,v.u,h.o,f.f]}),n})();var F=r(727),k=r(8372),A=r(2027),O=r(4954),U=r(2733),B=r(805),P=r(171);function N(n,p){if(1&n&&(e.TgZ(0,"div",2)(1,"div",3),e._UZ(2,"app-shared-review-cycle-progress",12),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("reviewCycle",null==t.progressBarStats?null:t.progressBarStats.reviewCycle)("totalPossibleReviews",null==t.progressBarStats?null:t.progressBarStats.totalPossibleReviews)("completedReviews",null==t.progressBarStats?null:t.progressBarStats.completedReviews)}}function J(n,p){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"button",14),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(),d=e.MAs(23);return o.targetReviewCycle=void 0,e.KtG(o.modalsController.openModal(d))}),e._UZ(2,"i",15),e._uU(3," Add new Review Cycle "),e.qZA()()}}function Y(n,p){1&n&&(e.TgZ(0,"div",16)(1,"h6"),e._uU(2,"More"),e.qZA()())}function Q(n,p){1&n&&(e.TgZ(0,"span",18),e._uU(1,"Current Cycle"),e.qZA())}function q(n,p){if(1&n){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2).$implicit,d=e.oxw(),w=e.MAs(23);return d.targetReviewCycle=o,e.KtG(d.modalsController.openModal(w))}),e._UZ(1,"i",21),e._uU(2," Edit "),e.qZA()}}function K(n,p){if(1&n&&(e.TgZ(0,"div",16),e.YNc(1,q,3,0,"button",19),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",t.canBeEdited)}}function H(n,p){if(1&n&&(e.TgZ(0,"div",4)(1,"div",7)(2,"p"),e._uU(3),e.YNc(4,Q,2,0,"span",17),e.qZA()(),e.TgZ(5,"div",8)(6,"p"),e._uU(7),e.qZA()(),e.TgZ(8,"div",8)(9,"p"),e._uU(10),e.qZA()(),e.YNc(11,K,2,1,"div",9),e.qZA()),2&n){const t=p.$implicit,i=e.oxw();e.xp6(3),e.hij(" ",t.name||"None on file"," "),e.xp6(1),e.Q6J("ngIf",t.hasStarted&&!t.hasEnded),e.xp6(3),e.AsE("",t.startDate||"None on file"," - ",t.startDate.displayTime(),""),e.xp6(3),e.AsE("",t.endDate||"None on file"," - ",t.endDate.displayTime(),""),e.xp6(1),e.Q6J("ngIf",i.canAddEditReviewCycles)}}function L(n,p){if(1&n){const t=e.EpF();e.TgZ(0,"reviews-add-edit-review-cycle-modal",22),e.NdJ("onSumbit",function(o){e.CHM(t);const d=e.oxw();return e.KtG(d.handleAddEditSubmission(o))})("onCloseModal",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.modalsController.closeUpperModal())})("onDeleteClick",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.handleDelete(null==o.targetReviewCycle?null:o.targetReviewCycle._id))}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("existing",t.targetReviewCycle)("processing",t.processingModalRequest)}}var m=(()=>{return(n=m||(m={}))[n.CREATE=0]="CREATE",n[n.EDIT=1]="EDIT",n[n.DELETE=2]="DELETE",m;var n})();let I=(()=>{class n{constructor(t,i,o,d,w){this.reviewCycleServiceApi=t,this.modalsController=i,this.messageService=o,this.router=d,this.authStateService=w,this.subscriptions=new F.w0,this.today=new A.p,this.aMonthAgo=new A.p,this.canAddEditReviewCycles=!1,this.allReviewCycles=[],this.processingModalRequest=!1,this.searchInputControl=new v.p4,this.subscriptions.add(this.searchInputControl.valueChanges.pipe((0,k.b)(350)).subscribe(M=>{this.searchInputControl.valid&&(console.log("New v2 calls"),this.fetchReviewCycles())})),this.subscriptions.add(this.authStateService.authState.subscribe(M=>{let Z;M.identity&&(Z=M.identity),this.canAddEditReviewCycles="SuperAdmin"==Z?.role||"Admin"==Z?.role})),this.progressBarStats={completedReviews:0,totalPossibleReviews:0}}ngOnInit(){this.today=new A.p,this.aMonthAgo=new A.p,this.aMonthAgo.date.setMonth(this.aMonthAgo.date.getMonth()-1),this.fetchCurrentReviewCycle(),this.fetchReviewCycles()}ngOnDestroy(){this.subscriptions.unsubscribe()}fetchCurrentReviewCycle(){this.reviewCycleServiceApi.getCurrentReviewCycle().then(t=>{this.currentReviewCycle!==t.reviewCycle&&(this.currentReviewCycle=t.reviewCycle?t.reviewCycle:void 0,this.fetchReviewCycleStats(this.currentReviewCycle?._id?this.currentReviewCycle?._id:""))}).catch(t=>{console.error(t)})}fetchReviewCycleStats(t){this.reviewCycleServiceApi.getProgressBarStats(t,{}).then(i=>{i.reviewCycle?._id.toString()===this.currentReviewCycle?._id.toString()&&(this.progressBarStats.reviewCycle=i.reviewCycle,this.progressBarStats.completedReviews=i.completedReviews,this.progressBarStats.totalPossibleReviews=i.totalPossibleReviews)}).catch(i=>{console.error(i)})}fetchReviewCycles(){this.reviewCycleServiceApi.getAllReviewCycles().then(t=>{t.reviewCycles.length&&(this.allReviewCycles=[]);for(let i of t.reviewCycles){if(null===i._id)continue;const o={_id:i._id,name:i.name,org:i.org,startDate:i.startDate,endDate:i.endDate};o.hasStarted=o.startDate.date.valueOf()<this.today.date.valueOf(),o.hasEnded=o.endDate.date.valueOf()<this.today.date.valueOf(),o.canBeEdited=!1,o.hasStarted?o.endDate.date.valueOf()>this.aMonthAgo.date.valueOf()&&(o.canBeEdited=!0):o.canBeEdited=!0,this.allReviewCycles.push(o)}this.allReviewCycles=this.allReviewCycles.sort((i,o)=>i.startDate.date.valueOf()<o.endDate.date.valueOf()?1:-1)}).catch(t=>{console.error(t)})}handleAddEditSubmission(t){let i,o=void 0!==this.targetReviewCycle?._id?m.EDIT:m.CREATE,d=this.currentReviewCycle?._id===t?._id;switch(o){case m.EDIT:i=this.reviewCycleServiceApi.editReviewCycle(t);break;case m.CREATE:i=this.reviewCycleServiceApi.createReviewCycle(t)}this.processingModalRequest=!0,i.then(w=>this.handleSuccessAddEdit(w,o,d)).catch(w=>this.handleErrorAddEdit(w,o)).finally(()=>{this.processingModalRequest=!1})}handleDelete(t){this.processingModalRequest=!0,this.reviewCycleServiceApi.deleteReviewCycle(t).then(i=>this.handleSuccessAddEdit(i,m.DELETE,!1)).catch(i=>this.handleErrorAddEdit(i,m.DELETE)).finally(()=>{this.processingModalRequest=!1})}handleSuccessAddEdit(t,i,o){let d;switch(i){case m.EDIT:d="Edited Review Cycle";break;case m.CREATE:d="Created new Review Cycle";break;case m.DELETE:d="Deleted Review Cycle"}this.messageService.add({severity:"success",summary:d,detail:"With title "+t.name,life:3e3}),o&&this.fetchCurrentReviewCycle(),this.fetchReviewCycles(),this.modalsController.closeAllModals()}handleErrorAddEdit(t,i){let o,d;switch(i){case m.EDIT:o="Could not edit";break;case m.CREATE:o="Could not create";break;case m.DELETE:o="Could not delete"}switch(t.message?.keiroError){case"KE060400":d="Review cycle does not exist";break;case"KE060401":d="The start date must be in the future";break;case"KE060402":d="The start date must be before the end date";break;case"KE060403":d="The dates cannot overlap with other review cycles";break;case"KE060404":d="The review cycle has already ended more than a month ago, it can no longer be modified";break;case"KE060405":d="The start date can't be modified because this review cycle has already begun";break;case"KE060406":d="The end date must be in the future";break;case"KE060407":d="The review cycle has already begun, it can no longer be deleted";break;default:d="Please retry",this.modalsController.closeAllModals()}this.messageService.add({severity:"error",summary:o,detail:d,life:4e3})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(O.m),e.Y36(U.l),e.Y36(B.ez),e.Y36(C.F0),e.Y36(P.V))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-create-window"]],decls:24,vars:4,consts:[[1,"animated","fadeIn"],["class","card",4,"ngIf"],[1,"card"],[1,"card-body"],[1,"row"],[1,"col-auto"],["class","col text-right",4,"ngIf"],[1,"col-4","col-md-3"],[1,"col-3","col-md-3"],["class","col-2 col-md-3",4,"ngIf"],["class","row",4,"ngFor","ngForOf"],["addEditWindowModal",""],["sectionHeader","Current Review Cycle",3,"reviewCycle","totalPossibleReviews","completedReviews"],[1,"col","text-right"],[1,"btn","btn-sm","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-plus-square"],[1,"col-2","col-md-3"],["class","badge badge-pill badge-primary",4,"ngIf"],[1,"badge","badge-pill","badge-primary"],["class","btn btn-sm btn-secondary",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-secondary",3,"click"],["aria-hidden","true",1,"fa","fa-pencil-alt"],[3,"existing","processing","onSumbit","onCloseModal","onDeleteClick"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e.YNc(1,N,3,3,"div",1),e.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h4"),e._uU(7,"All Review Cycles"),e.qZA()(),e.YNc(8,J,4,0,"div",6),e.qZA(),e.TgZ(9,"div")(10,"div",4)(11,"div",7)(12,"h6"),e._uU(13,"Review cycle:"),e.qZA()(),e.TgZ(14,"div",8)(15,"h6"),e._uU(16,"Cycle start:"),e.qZA()(),e.TgZ(17,"div",8)(18,"h6"),e._uU(19,"Cycle end:"),e.qZA()(),e.YNc(20,Y,3,0,"div",9),e.qZA(),e.YNc(21,H,12,7,"div",10),e.qZA()()()(),e.YNc(22,L,1,2,"ng-template",null,11,e.W1O)),2&t&&(e.xp6(1),e.Q6J("ngIf",i.currentReviewCycle),e.xp6(7),e.Q6J("ngIf",i.canAddEditReviewCycles),e.xp6(12),e.Q6J("ngIf",i.canAddEditReviewCycles),e.xp6(1),e.Q6J("ngForOf",i.allReviewCycles))},encapsulation:2}),n})();var W=r(9213);let V=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[C.Bz.forChild([{path:"",component:I}]),s.ez,v.UX,y.nM,_.lN,b.c,T.HC.forRoot(),h.j,f._8,g.l]}),n})();e.B6R(I,function(){return[s.sg,s.O5,W.p,D]},[])},8372:(S,E,r)=>{r.d(E,{b:()=>b});var s=r(4986),v=r(4482),_=r(5403);function b(C,y=s.z){return(0,v.e)((T,f)=>{let h=null,g=null,e=null;const R=()=>{if(h){h.unsubscribe(),h=null;const u=g;g=null,f.next(u)}};function l(){const u=e+C,a=y.now();if(a<u)return h=this.schedule(void 0,u-a),void f.add(h);R()}T.subscribe((0,_.x)(f,u=>{g=u,e=y.now(),h||(h=y.schedule(l,C),f.add(h))},()=>{R(),f.complete()},void 0,()=>{g=h=null}))})}},4175:(S,E,r)=>{r.d(E,{HC:()=>R,O1:()=>e});var s=r(1571),v=r(1607),_=r(6895);const b=["*"];function C(l,u){1&l&&s.GkF(0)}function y(l,u){if(1&l&&(s.TgZ(0,"bar",3),s.Hsn(1),s.qZA()),2&l){const a=s.oxw();s.Q6J("type",a.type)("value",a._value)("max",a.max)("animate",a.animate)("striped",a.striped)}}function T(l,u){if(1&l&&(s.TgZ(0,"bar",3),s._uU(1),s.qZA()),2&l){const a=u.$implicit,c=s.oxw(2);s.Q6J("type",a.type)("value",a.value)("max",a.max||c.max)("animate",c.animate)("striped",c.striped),s.xp6(1),s.Oqu(a.label)}}function f(l,u){if(1&l&&s.YNc(0,T,2,6,"bar",4),2&l){const a=s.oxw();s.Q6J("ngForOf",a._values)}}let h=(()=>{class l{constructor(a,c){this.el=a,this.renderer=c,this.max=100,this.value=0,this.animate=!1,this.striped=!1,this.type="info",this.percent=100}get isBs3(){return(0,v.XA)()}ngOnChanges(a){(a.value||a.max)&&(this.percent=Number(a.value?.currentValue||this.value)/Number(a.max?.currentValue||this.max||100)*100),a.type&&this.applyTypeClasses()}applyTypeClasses(){if(this._prevType){const c=`bg-${this._prevType}`;this.renderer.removeClass(this.el.nativeElement,`progress-bar-${this._prevType}`),this.renderer.removeClass(this.el.nativeElement,c),this._prevType=void 0}if(this.type){const c=`bg-${this.type}`;this.renderer.addClass(this.el.nativeElement,`progress-bar-${this.type}`),this.renderer.addClass(this.el.nativeElement,c),this._prevType=this.type}}}return l.\u0275fac=function(a){return new(a||l)(s.Y36(s.SBq),s.Y36(s.Qsj))},l.\u0275cmp=s.Xpm({type:l,selectors:[["bar"]],hostAttrs:["role","progressbar","aria-valuemin","0"],hostVars:15,hostBindings:function(a,c){2&a&&(s.uIk("aria-valuenow",c.value)("aria-valuetext",c.percent?c.percent.toFixed(0)+"%":"")("aria-valuemax",c.max),s.Udp("height","100","%")("width",c.percent,"%"),s.ekj("progress-bar",!0)("progress-bar-animated",!c.isBs3&&c.animate)("progress-bar-striped",c.striped)("active",c.isBs3&&c.animate))},inputs:{max:"max",value:"value",animate:"animate",striped:"striped",type:"type"},features:[s.TTD],ngContentSelectors:b,decls:1,vars:0,template:function(a,c){1&a&&(s.F$t(),s.Hsn(0))},encapsulation:2,changeDetection:0}),l})(),g=(()=>{class l{constructor(){this.animate=!1,this.max=100}}return l.\u0275fac=function(a){return new(a||l)},l.\u0275prov=s.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})(),e=(()=>{class l{constructor(a){this.max=100,this.animate=!1,this.striped=!1,this.isStacked=!1,this._value=0,Object.assign(this,a)}set value(a){this.isStacked=Array.isArray(a),"number"==typeof a?(this._value=a,this._values=void 0):(this._value=void 0,this._values=a)}}return l.\u0275fac=function(a){return new(a||l)(s.Y36(g))},l.\u0275cmp=s.Xpm({type:l,selectors:[["progressbar"]],hostVars:3,hostBindings:function(a,c){2&a&&(s.uIk("max",c.max),s.ekj("progress",!0))},inputs:{max:"max",animate:"animate",striped:"striped",type:"type",value:"value"},ngContentSelectors:b,decls:5,vars:3,consts:[[4,"ngIf","ngIfThen","ngIfElse"],["NotStacked",""],["Stacked",""],[3,"type","value","max","animate","striped"],[3,"type","value","max","animate","striped",4,"ngFor","ngForOf"]],template:function(a,c){if(1&a&&(s.F$t(),s.YNc(0,C,1,0,"ng-container",0),s.YNc(1,y,2,5,"ng-template",null,1,s.W1O),s.YNc(3,f,1,1,"ng-template",null,2,s.W1O)),2&a){const x=s.MAs(2),D=s.MAs(4);s.Q6J("ngIf",!c.isStacked)("ngIfThen",x)("ngIfElse",D)}},dependencies:[_.sg,_.O5,h],styles:["[_nghost-%COMP%]{width:100%;display:flex}"],changeDetection:0}),l})(),R=(()=>{class l{static forRoot(){return{ngModule:l,providers:[]}}}return l.\u0275fac=function(a){return new(a||l)},l.\u0275mod=s.oAB({type:l}),l.\u0275inj=s.cJS({imports:[_.ez]}),l})()}}]);