"use strict";(self.webpackChunkalasta_ui=self.webpackChunkalasta_ui||[]).push([[497],{1658:(C,w,s)=>{s.d(w,{d:()=>u});var g=s(4004);class u{static valueNotInArray(a){return r=>a.includes(r.value)?{valueInArray:{value:r.value}}:null}static valueInArray(a){return r=>a.includes(r.value)?null:{valueNotInOptions:{value:r.value}}}static optionalValueInArray(a){return r=>a.pipe((0,g.U)(d=>d.includes(r.value)),(0,g.U)(d=>d?null:{valueNotInOptions:{value:r.value}}))}static allOrNothing(a){return r=>{const d=a.some(c=>{var n;return null===(n=r.get(c))||void 0===n?void 0:n.value}),f=a.every(c=>{var n;return null===(n=r.get(c))||void 0===n?void 0:n.value});return a.forEach(c=>{let n=r.get(c);d&&!f?(null==n?void 0:n.value)||null==n||n.setErrors(Object.assign(Object.assign({},n.errors),{allOrNothing:d})):(null==n?void 0:n.errors)&&n.errors.allOrNothing&&(delete n.errors.allOrNothing,n.markAsUntouched(),n.updateValueAndValidity())}),d&&!f?{allOrNothing:d}:null}}static isInteger(){return a=>{const r=parseFloat(a.value);return!isNaN(r)&&isFinite(r)&&Number.isInteger(r)&&"number"==typeof r?null:{notInteger:{value:a.value}}}}static isNumeric(){return a=>!isNaN(parseFloat(a.value))&&isFinite(a.value)?null:{notNumeric:{value:a.value}}}static isWithinDates(a,r,d){return f=>d.date.valueOf()>a.date.valueOf()&&d.date.valueOf()<r.date.valueOf()?null:{dateNotAcceptable:{value:f.value}}}}},2497:(C,w,s)=>{s.r(w),s.d(w,{CreateReviewModule:()=>M});var g=s(9808),u=s(2382),T=s(7322),a=s(7531),r=s(4107),d=s(5399),f=s(1217),c=s(2306),n=s(1035),y=s(727),S=s(9300),A=s(2027),h=s(826),R=s(1658),p=s(582),e=s(4893),N=s(18),q=s(921),E=s(508);function U(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"div",7),e.TgZ(2,"p",8),e._uU(3,"No talents currently selected"),e.qZA(),e.TgZ(4,"button",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().goToTalentFinder()}),e._uU(5,"Select talents in Talent Finder"),e.qZA(),e.qZA(),e.qZA()}}function O(i,l){if(1&i&&(e.TgZ(0,"p",31),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.formGroup.errors.notSaved.message)}}function D(i,l){if(1&i&&(e.TgZ(0,"p",19),e.TgZ(1,"strong",20),e._uU(2,"Position:"),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(3),e.Oqu(t.talentInfo.position)}}function F(i,l){if(1&i&&(e.TgZ(0,"p",19),e.TgZ(1,"strong",20),e._uU(2,"Property:"),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(3),e.Oqu(t.talentInfo.location)}}function V(i,l){if(1&i&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&i){const t=l.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.display)}}const Y=function(i){return{"border-danger":i}};function P(i,l){if(1&i&&(e.TgZ(0,"div",15),e.TgZ(1,"div",16),e.YNc(2,O,2,1,"p",17),e.TgZ(3,"div",18),e.TgZ(4,"p",19),e.TgZ(5,"strong",20),e._uU(6,"Name:"),e.qZA(),e._uU(7),e.qZA(),e.YNc(8,D,4,1,"p",21),e.YNc(9,F,4,1,"p",21),e.qZA(),e.TgZ(10,"div",22),e.TgZ(11,"form",23),e.TgZ(12,"div",24),e.TgZ(13,"div",25),e.TgZ(14,"mat-label",26),e._UZ(15,"br"),e.qZA(),e.TgZ(16,"mat-form-field",27),e.TgZ(17,"mat-label"),e._uU(18,"Performance Score %"),e.qZA(),e._UZ(19,"input",28),e.TgZ(20,"mat-error"),e._uU(21),e.qZA(),e.qZA(),e.qZA(),e.TgZ(22,"div",25),e.TgZ(23,"mat-label",26),e._UZ(24,"br"),e.qZA(),e.TgZ(25,"mat-form-field",27),e.TgZ(26,"mat-label"),e._uU(27,"Potential Score"),e.qZA(),e.TgZ(28,"mat-select",29),e.YNc(29,V,2,2,"mat-option",30),e.qZA(),e.TgZ(30,"mat-error"),e._uU(31),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&i){const t=l.$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngClass",e.VKq(15,Y,t.formGroup.touched&&t.formGroup.errors)),e.xp6(1),e.Q6J("ngIf",t.formGroup.hasError("notSaved")&&t.formGroup.errors.notSaved.message),e.xp6(5),e.Oqu(t.talentInfo.name),e.xp6(1),e.Q6J("ngIf",t.talentInfo.position),e.xp6(1),e.Q6J("ngIf",t.talentInfo.location),e.xp6(2),e.Q6J("formGroup",t.formGroup),e.xp6(5),e.Udp("width",100,"%"),e.xp6(3),e.hYB("placeholder","",o.reviewValidRanges.per.min+1," - ",o.reviewValidRanges.per.max,"%"),e.xp6(2),e.Oqu(o.prettifyError(t.formGroup.controls.performanceScore.errors)),e.xp6(4),e.Udp("width",100,"%"),e.xp6(4),e.Q6J("ngForOf",o.potentialRanges),e.xp6(2),e.Oqu(o.prettifyError(t.formGroup.controls.potentialScore.errors))}}function W(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",10),e.TgZ(1,"div",11),e.TgZ(2,"p",12),e._uU(3,"Currently saving reviews for the review cycle: "),e.TgZ(4,"b"),e._uU(5),e.qZA(),e._uU(6),e.qZA(),e.TgZ(7,"p"),e._uU(8),e.qZA(),e.qZA(),e.YNc(9,P,32,17,"div",13),e.TgZ(10,"button",14),e.NdJ("click",function(){e.CHM(t);const m=e.oxw(),_=e.MAs(8);return m.saveTalents(_)}),e._uU(11,"Save reviews"),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(5),e.Oqu(null==t.currentReviewWindow?null:t.currentReviewWindow.name),e.xp6(1),e.hij(" on ",t.today,"."),e.xp6(2),e.hij("The last day for saving reviews in the current cycle is: ",null==t.currentReviewWindow?null:t.currentReviewWindow.endDate,"."),e.xp6(1),e.Q6J("ngForOf",t.talentsToReview),e.xp6(1),e.Q6J("disabled",-1!=t.queueResponseTalentIdx||0==t.talentsToReview.length)}}function G(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"bulk-save-progress-modal",33),e.NdJ("close",function(){return e.CHM(t),e.oxw().closeProgressModal()}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("progress",t.savingProgress)}}class J{constructor(l,t,o,m){this.customValidators=new R.d,this.talentInfo=l,this.formGroup=t,this.dateOfReview=m,this.formGroup.setValidators([R.d.isWithinDates(o.startDate,o.endDate,m)])}simplify(){var l,t;let o={};return this.formGroup.markAllAsTouched(),o.valid=this.formGroup.valid,o.id=this.talentInfo.id,o.performanceScore=null===(l=this.formGroup.get("performanceScore"))||void 0===l?void 0:l.value,o.potentialScore=null===(t=this.formGroup.get("potentialScore"))||void 0===t?void 0:t.value,o.dateOfReview=this.dateOfReview.date,o}}let Q=(()=>{class i{constructor(t,o,m,_,Z,L){this.modalService=t,this.router=o,this.fb=m,this.sessionStateService=_,this.store=Z,this.actionDispatcher=L,this.today=new A.p,this.talentsToReview=[],this.potentialRanges=[{value:1,display:"Low"},{value:2,display:"Medium"},{value:3,display:"High"}],this.reviewValidRanges={per:{min:0,max:0},pot:{min:0,max:0}},this.subscriptions=new y.w0,this.talentsToReviewQueue=[],this.queueResponseTalentIdx=-1,this.savingProgress=new p.jh(0),this.talentManagement$=Z.pipe((0,n.Ys)("talentManagementState")),this.dashboard$=Z.pipe((0,n.Ys)("dashboardState")),this.reviewWindow$=Z.pipe((0,n.Ys)("reviewWindowState")),this.subscriptions.add(this.dashboard$.subscribe(v=>{v.boxesInfo[2]&&(this.reviewValidRanges.per.max=v.boxesInfo[2].perRng.high,this.reviewValidRanges.pot.max=v.boxesInfo[2].potRng.high),v.boxesInfo[6]&&(this.reviewValidRanges.per.min=v.boxesInfo[6].perRng.low,this.reviewValidRanges.pot.min=v.boxesInfo[6].potRng.low)})),this.subscriptions.add(this.reviewWindow$.subscribe(v=>{this.currentReviewWindow=v.currentWindowReview||void 0})),this.subscriptions.add(this.talentManagement$.subscribe(v=>{this.talentsToReview=v.selectedTalents.map(x=>{var I,b;return new J(x,this.fb.group({performanceScore:["",[u.kI.required,R.d.isInteger(),u.kI.min(this.reviewValidRanges.per.min+1),u.kI.max(this.reviewValidRanges.per.max)]],potentialScore:["",[u.kI.required,R.d.isInteger(),u.kI.min(this.reviewValidRanges.pot.min),u.kI.max(this.reviewValidRanges.pot.max)]]}),{startDate:(null===(I=this.currentReviewWindow)||void 0===I?void 0:I.startDate)||new A.p,endDate:(null===(b=this.currentReviewWindow)||void 0===b?void 0:b.endDate)||new A.p},this.today)})}));let $=[h.Yc.ADD_TALENT_REVIEW_SUCCESS,h.Yc.ADD_TALENT_REVIEW_FAILURE];this.subscriptions.add(this.actionDispatcher.pipe((0,S.h)(v=>$.includes(v.type))).subscribe(v=>{let x=this.talentsToReview[this.queueResponseTalentIdx];v.type==h.Yc.ADD_TALENT_REVIEW_SUCCESS&&(this.savingProgress.successful++,this.savingProgress.progressBarDisplay[p.CX.SUCCESS].value++,x.formGroup.disable()),v.type==h.Yc.ADD_TALENT_REVIEW_FAILURE&&(this.savingProgress.failed++,this.savingProgress.progressBarDisplay[p.CX.FAILURE].value++,x.formGroup.setErrors({notSaved:{message:"There was a problem saving this review"}})),this.saveNextTalent()})),this.subscriptions.add(this.sessionStateService.onSessionDestroyed.subscribe(v=>{this.modalRef&&this.modalRef.hide()}))}ngOnDestroy(){this.store.dispatch((0,h.XA)()),this.subscriptions.unsubscribe()}goToTalentFinder(){this.router.navigate(["app","talent","finder"])}prettifyError(t){return t?t.required?"Required":t.min||t.max?"Invalid":t.notNumeric?"Not number":t.notInteger?"Contains decimal":"":""}saveNextTalent(){if(this.savingProgress.pending--,0==this.talentsToReviewQueue.length)return this.queueResponseTalentIdx=-1,this.talentsToReviewQueue=[],void(this.savingProgress.status=p.Wg.FINISHED);this.queueResponseTalentIdx++;const t=this.talentsToReviewQueue.shift();t.valid?this.store.dispatch((0,h.YT)({talentReview:t})):(this.savingProgress.failed++,this.savingProgress.progressBarDisplay[p.CX.FAILURE].value++,this.talentsToReview[this.queueResponseTalentIdx].formGroup.setErrors({notSaved:{message:"This form has not been completed yet"}}),this.saveNextTalent())}saveTalents(t){this.talentsToReviewQueue=this.talentsToReview.map(o=>o.simplify()),this.savingProgress=new p.jh(this.talentsToReviewQueue.length),this.savingProgress.status=p.Wg.IN_PROGRESS,this.modalRef=this.modalService.show(t,{ignoreBackdropClick:!0,keyboard:!1}),this.saveNextTalent()}closeProgressModal(){var t;null===(t=this.modalRef)||void 0===t||t.hide(),this.talentsToReview=this.talentsToReview.filter(o=>o.formGroup.hasError("notSaved"))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(N.tT),e.Y36(d.F0),e.Y36(u.qu),e.Y36(q.W),e.Y36(n.yh),e.Y36(n.mK))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-create-review"]],decls:9,vars:2,consts:[[1,"animated","fadeIn"],[1,"card"],[1,"card-body"],["class","row",4,"ngIf"],["class","row px-3",4,"ngIf"],["savingInProcessModal",""],[1,"row"],[1,"col","text-center"],[1,"mb-1"],[1,"btn","btn-block","btn-primary",3,"click"],[1,"row","px-3"],[1,"col-12","border","rounded","border-warning"],[1,"py-2","m-0"],["class","col-12",4,"ngFor","ngForOf"],["title","Save reviews for talents",1,"btn","btn-block","btn-success",3,"disabled","click"],[1,"col-12"],[1,"row","align-items-center","border","border-secondary","shadow-sm","rounded","py-2","my-1",3,"ngClass"],["class","col-12 m-0 text-danger",4,"ngIf"],[1,"col-12","col-md-6","col-lg-4"],[1,"m-0","p-0"],[1,"pr-1"],["class","m-0 p-0",4,"ngIf"],[1,"col-12","col-md-6","col-lg-8"],["autocomplete","off",3,"formGroup"],[1,"form-row","align-items-center"],[1,"col-12","col-sm-6","col-md-6"],[1,"d-block"],["appearance","outline"],["type","number","formControlName","performanceScore","matInput","","autocomplete","off","name","performanceScore",3,"placeholder"],["formControlName","potentialScore"],[3,"value",4,"ngFor","ngForOf"],[1,"col-12","m-0","text-danger"],[3,"value"],["savingResource","review",3,"progress","close"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"h4"),e._uU(4,"Add reviews"),e.qZA(),e.YNc(5,U,6,0,"div",3),e.YNc(6,W,12,5,"div",4),e.qZA(),e.qZA(),e.qZA(),e.YNc(7,G,1,1,"ng-template",null,5,e.W1O)),2&t&&(e.xp6(5),e.Q6J("ngIf",!o.talentsToReview.length),e.xp6(1),e.Q6J("ngIf",o.talentsToReview.length))},directives:[g.O5,g.sg,g.mk,u._Y,u.JL,u.sg,T.hX,T.KE,u.wV,u.Fj,a.Nt,u.JJ,u.u,T.TO,r.gD,E.ey,p.ng],encapsulation:2}),i})(),M=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[d.Bz.forChild([{path:"",component:Q}]),g.ez,u.UX,T.lN,a.c,r.LD,f.HC.forRoot(),c.t]]}),i})()}}]);